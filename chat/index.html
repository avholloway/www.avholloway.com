<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webex Contact Center Live Chat</title>
    <style>
      .customized-imi-chatbutton {
        display: none !important;
      }
      .customized-divchatmain {
        left: 12px !important;
        bottom: 12px !important;
      }
    </style>
  </head>
  <body>
    <h1>Webex Contact Center Live Chat</h1>
    <p>I am testing an AI Agent which can answer questions about WxCC Administration and AirTable integrations, as well as the proactive chat feature, which should pop up after about 5 seconds.</p>
    <div style="display: none;">
      Name: <input id="customer_name" name="customer_name" /><br />
      Email: <input id="customer_email" name="customer_email" /><br />
      <button id="custom-chat-button">Custom Chat Button</button>
      <span
        id="update_status"
        style="color: coral; font-weight: bold; display: none"
        >Data attached!</span
      >
    </div>
    <div
      id="divicw"
      data-bind="40174D1F-6FBE-4AE4-A8D2-1AF3821F2291"
      data-org=""
      data-guid="d3201d49-c897-490f-91ac-7ca9382cf731"
    ></div>
    <script>
      var i = {
        t: function (t) {
          var e = "https://media.imi.chat/widget/js/imichatinit.js";
          try {
            var o = new XMLHttpRequest();
            o.onreadystatechange = function () {
              if (this.readyState == 4) {
                var t = document.getElementById("divicw");
                if (this.status == 0) {
                  i.o(t);
                  return;
                }
                var e = document.createElement("script");
                e.innerHTML = this.responseText;
                t.parentNode.insertBefore(e, t.nextSibling);
              }
            };
            o.open("GET", e, true);
            o.send();
          } catch (s) {
            console.error(s);
          }
        },
        o: function (t) {
          t.insertAdjacentHTML(
            "afterend",
            '<iframe id="tls_al_frm" frameborder="0" style="overflow: hidden;height: 208px;width: 394px;position: fixed;display: block;left: 12px;bottom: 12px;z-index: 99999; display:none;"></iframe>'
          );
          var e = document.getElementById("tls_al_frm");
          var o =
            e.contentWindow || e.contentDocument.document || e.contentDocument;
          o.document.open();
          o.document.write(
            '<!doctype html><html><head><meta charset="utf-8"><title>Untitled Document</title><style>body{font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;color: #99a0b0;font-size: 14px;}.popover__content{background-color: #fbfbfe; padding: 1.5rem; border-radius: 5px; width: 300px; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);position: relative;}.popover__message{font-weight: 600;color:#56627c;font-size: 16px;}.pull-left{float:left;}.clearfix{clear: both;}.hdr-txt{width: 218px; margin-top: 3px;}.para-txt a{text-decoration: none;color: #005cde;}.close-btn{position: absolute;right:15px;top:15px;}.close-btn a{text-decoration: none;font-weight: 400; color: #56627c; font-size: 16px;}</style></head><body><div class="popover__content"><div class="close-btn"><a href="#" onclick="closeTLSAlert();">X</a></div><div class="popover__message"><div class="pull-left hdr-txt">This browser version is not supported on LiveChat.</div></div><div class="clearfix"></div><p class="para-txt">Please update your browser to the latest version and re-open the website to access the widget. </p></div><script>function closeTLSAlert(){window.parent.postMessage({key: "close_tls_alert",value: "close_tls_alert",action: "close_tls_alert"}, "*");}<\\/script></body></html>'
          );
          o.document.close();
          e.style.display = "block";
          window.addEventListener("message", function (t) {
            if (t.data.action == "close_tls_alert") {
              i.s();
            }
          });
        },
        s: function () {
          var t = document.getElementById("tls_al_frm");
          t.remove();
        },
      };
      i.t(function (t) {});

      /*
      // custom code addition to pass website data to webex connect flow
      // setup a recurring check every 250ms to know when we're ready to send data
      const wait_code = setInterval(() => {
        console.log(
          "%cChecking for imichatwidget...",
          "color: coral; font-weight: bold;"
        );

        // if chat widget global object isn't present, continue to wait longer
        if (typeof imichatwidget === "undefined") return;

        console.log(
          "%cFound imichatwidget, checking for on() function...",
          "color: coral; font-weight: bold;"
        );

        // if chat widget on function isn't present, continue to wait longer
        if (typeof imichatwidget.on === "undefined") return;

        // chat widget global object is now found, so we stop waiting for it
        clearInterval(wait_code);

        console.log(
          "%cFound imichatwidget and on(). Ready to go!",
          "color: coral; font-weight: bold;"
        );

        imichatwidget.on("imichat-widget:ready", () => {
          console.log(
            "%cimichatwidget.on(ready) has fired! Loading up data!",
            "color: coral; font-weight: bold;"
          );

          const customer_name = document.getElementById("customer_name");
          const customer_email = document.getElementById("customer_email");

          const random_person = Math.floor(Math.random() * 4);
          customer_name.value = [
            "Anthony Holloway",
            "Elizabeth Holloway",
            "Ethan Holloway",
            "Addison Holloway",
          ][random_person];

          customer_email.value = [
            "anthony@holloway.com",
            "elizabeth@holloway.com",
            "ethan@holloway.com",
            "addison@holloway.com",
          ][random_person];

          const data = JSON.stringify({
            custom_chat_fields: {
              name: customer_name.value,
              email: customer_email.value,
            },
          });

          console.log(`%c${data}`, "color: coral; font-weight: bold;");

          // attach the data
          imichatwidget.init(data, () => {
            console.log("%cData attached!", "color: coral; font-weight: bold;");
            document.getElementById("update_status").style.display = "block";
            setTimeout(() => {
              document.getElementById("update_status").style.display = "none";
            }, 2000);
          });

          const chat_button_frame = document.querySelector("#imi-chatbutton");
          chat_button_frame.classList.add("customized-imi-chatbutton");

          const chat_button_dom = chat_button_frame.contentWindow ? chat_button_frame.contentWindow.document : chat_button_frame.contentDocument;
          const chat_button_obj = chat_button_dom.querySelector("#widgetlbtn");

          const chat_window = document.querySelector("#divchatmain");
          chat_window.classList.add("customized-divchatmain");

          document.querySelector("#custom-chat-button").addEventListener("click", _ => {
            console.log("%cCustom Chat Button Clicked", "color: coral; font-weight: bold;");
            chat_button_obj.click();
          });
        });
      }, 250);
      */
    </script>
  </body>
</html>
